import{u as e,r as t,j as s}from"./index-B-UK4bm4.js";import{o as i,p as o,i as a,j as n,q as r,l,r as d}from"./star_fill_40-DYdcEbYe.js";import{E as c}from"./EditWordModal-Dl1WzW05.js";import{u as m,E as u}from"./EntityListPage-Ce_Hh8bA.js";import{B as h}from"./FormInput-DPqEQViA.js";import"./Link-_nr1jjt6.js";import"./IconContainer-OH4W15N3.js";const p="_actions_6stx1_1",f="_editButton_6stx1_7",g="_deleteButton_6stx1_11",x="_copyButton_6stx1_20",j=()=>{const j=e(),[y,_]=t.useState([]),[k,N]=t.useState(""),[b,v]=t.useState(null),[C,w]=t.useState(""),[F,M]=t.useState(!1),S=m(k,300),{data:q,fetchNextPage:z,hasNextPage:B,isFetching:E,isFetchingNextPage:L}=i(S),P=t.useMemo(()=>q?.pages.flatMap(e=>e.items.map(o))??[],[q]),I=E&&0===P.length||L;t.useEffect(()=>{_([])},[S]);const Q=e=>{_(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},T=t.useMemo(()=>P.filter(e=>y.includes(e.id)),[P,y]),K=e=>{v(e.id),w(e.title),M(!0)},R=()=>{M(!1),v(null),w("")},D=1===y.length,W=D?P.find(e=>e.id===y[0]):null,A=s.jsxs("div",{className:p,children:[D?s.jsx(h,{size:"m",stretched:!0,mode:"outline",className:f,onClick:()=>{W&&K(W)},children:"Редактировать"}):null,s.jsxs(h,{size:"m",stretched:!0,mode:"outline",className:g,onClick:()=>{if(0===y.length)return;const e=y.map(e=>Number(e)).filter(e=>Number.isFinite(e));0!==e.length&&r({ids:e}).then(()=>{_([]),j.invalidateQueries({queryKey:l.keywordsRoot}),j.invalidateQueries({queryKey:l.me})}).catch(e=>{console.error("Failed to delete keywords",e),alert("Не удалось удалить слова. Попробуйте еще раз.")})},before:s.jsx(a,{size:20}),children:["Удалить (",y.length,")"]}),s.jsx(h,{size:"m",stretched:!0,mode:"filled",className:x,onClick:()=>{const e=T.map(e=>e.title).join("\n").trim();e&&navigator?.clipboard?.writeText&&navigator.clipboard.writeText(e).catch(()=>{})},before:s.jsx(n,{size:20}),children:"Копировать"})]});return s.jsxs(s.Fragment,{children:[s.jsx(u,{title:"Ключевые слова",description:"Добавьте ключевые слова, которые хотите отслеживать.",addLabel:"Добавить слова",addPath:"/keywords/add",items:P,emptyTitle:"Ключевых слов пока нет",emptyDescription:"Добавьте первое слово и начните мониторинг.",query:k,onQueryChange:N,isLoading:I,hasMore:Boolean(B),onLoadMore:()=>z(),onItemClick:e=>{y.length>0?Q(e.id):K(e)},selection:{selectedIds:y,onToggle:Q,actions:A}}),s.jsx(c,{open:F,title:"Редактировать слово",value:C,onChange:w,onSave:()=>{if(!b)return;const e=C.trim();e&&d(Number(b),{value:e}).then(()=>{j.invalidateQueries({queryKey:l.keywordsRoot})}).catch(e=>{console.error("Failed to update keyword",e),alert("Не удалось сохранить слово. Попробуйте еще раз.")}).finally(()=>{_([]),R()})},onClose:R})]})};export{j as KeywordsPage};
