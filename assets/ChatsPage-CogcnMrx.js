import{u as e,r as t,j as s}from"./index-DxtWIYpD.js";import{h as i,m as a,i as o,j as r,k as n,l as c}from"./star_fill_40-OewN37kb.js";import{u as l,E as d}from"./EntityListPage-D20WQEoc.js";import{B as m}from"./FormInput-DEeNPYk6.js";import"./Link-BsGBdGvh.js";import"./IconContainer-Lt9Y-dB3.js";const u="_actions_2txct_1",h="_deleteButton_2txct_6",p="_copyButton_2txct_15",f=()=>{const f=e(),[g,x]=t.useState([]),[j,_]=t.useState(""),y=l(j,300),{data:b,fetchNextPage:N,hasNextPage:v,isFetching:F,isFetchingNextPage:L}=i(y),M=t.useMemo(()=>b?.pages.flatMap(e=>e.items.map(a))??[],[b]),P=F&&0===M.length||L;t.useEffect(()=>{x([])},[y]);const k=t.useMemo(()=>M.filter(e=>g.includes(e.id)),[M,g]),z=s.jsxs("div",{className:u,children:[s.jsxs(m,{size:"m",stretched:!0,mode:"outline",className:h,onClick:()=>{if(0===g.length)return;const e=g.map(e=>Number(e)).filter(e=>Number.isFinite(e));0!==e.length&&n({ids:e}).then(()=>{x([]),f.invalidateQueries({queryKey:c.chatsRoot}),f.invalidateQueries({queryKey:c.me})}).catch(e=>{console.error("Failed to delete chats",e),alert("Не удалось удалить чаты. Попробуйте еще раз.")})},before:s.jsx(o,{size:20}),children:["Удалить (",g.length,")"]}),s.jsx(m,{size:"m",stretched:!0,mode:"filled",className:p,onClick:()=>{const e=k.map(e=>e.subtitle??e.title).join("\n").trim();e&&navigator?.clipboard?.writeText&&navigator.clipboard.writeText(e).catch(()=>{})},before:s.jsx(r,{size:20}),children:"Копировать"})]});return s.jsx(d,{title:"Чаты",description:"Добавьте чаты, где общаются ваши потенциальные клиенты.",addLabel:"Добавить чаты",addPath:"/chats/add",items:M,emptyTitle:"Список чатов пуст",emptyDescription:"Добавьте первый чат, чтобы начать отслеживание.",query:j,onQueryChange:_,isLoading:P,hasMore:Boolean(v),onLoadMore:()=>N(),selection:{selectedIds:g,onToggle:e=>{x(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},actions:z}})};export{f as ChatsPage};
