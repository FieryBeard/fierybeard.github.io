import{u as e,r as t,j as s}from"./index-DKbnxsrn.js";import{t as i,v as o,i as a,j as n,w as r,l,x as d}from"./star_fill_40-BX4l-VAK.js";import{E as c}from"./EditWordModal-DsCgYn3E.js";import{u as m,E as u}from"./EntityListPage-DUwXvpbl.js";import{B as h}from"./FormInput-M3iRKN8B.js";import"./Link-cJNdymoi.js";import"./IconContainer-BCLHwQWG.js";const p="_actions_6stx1_1",f="_editButton_6stx1_7",g="_deleteButton_6stx1_11",x="_copyButton_6stx1_20",j=()=>{const j=e(),[_,y]=t.useState([]),[v,N]=t.useState(""),[b,C]=t.useState(null),[F,w]=t.useState(""),[M,S]=t.useState(!1),k=m(v,300),{data:z,fetchNextPage:B,hasNextPage:E,isFetching:L,isFetchingNextPage:P}=i(k),q=t.useMemo(()=>z?.pages.flatMap(e=>e.items.map(o))??[],[z]),I=L&&0===q.length||P;t.useEffect(()=>{y([])},[k]);const Q=e=>{y(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},T=t.useMemo(()=>q.filter(e=>_.includes(e.id)),[q,_]),K=e=>{C(e.id),w(e.title),S(!0)},W=()=>{S(!1),C(null),w("")},R=1===_.length,D=R?q.find(e=>e.id===_[0]):null,A=s.jsxs("div",{className:p,children:[R?s.jsx(h,{size:"m",stretched:!0,mode:"outline",className:f,onClick:()=>{D&&K(D)},children:"Редактировать"}):null,s.jsxs(h,{size:"m",stretched:!0,mode:"outline",className:g,onClick:()=>{if(0===_.length)return;const e=_.map(e=>Number(e)).filter(e=>Number.isFinite(e));0!==e.length&&r({ids:e}).then(()=>{y([]),j.invalidateQueries({queryKey:l.minusWordsRoot}),j.invalidateQueries({queryKey:l.me})}).catch(e=>{console.error("Failed to delete minus words",e),alert("Не удалось удалить минус-слова. Попробуйте еще раз.")})},before:s.jsx(a,{size:20}),children:["Удалить (",_.length,")"]}),s.jsx(h,{size:"m",stretched:!0,mode:"filled",className:x,onClick:()=>{const e=T.map(e=>e.title).join("\n").trim();e&&navigator?.clipboard?.writeText&&navigator.clipboard.writeText(e).catch(()=>{})},before:s.jsx(n,{size:20}),children:"Копировать"})]});return s.jsxs(s.Fragment,{children:[s.jsx(u,{title:"Минус-слова",description:"Добавьте слова, которые нужно исключить из отслеживания.",addLabel:"Добавить минус-слова",addPath:"/minus-words/add",items:q,emptyTitle:"Минус-слов пока нет",emptyDescription:"Добавьте исключения, чтобы фильтровать нерелевантные сообщения.",query:v,onQueryChange:N,isLoading:I,hasMore:Boolean(E),onLoadMore:()=>B(),onItemClick:e=>{_.length>0?Q(e.id):K(e)},selection:{selectedIds:_,onToggle:Q,actions:A}}),s.jsx(c,{open:M,title:"Редактировать минус-слово",value:F,onChange:w,onSave:()=>{if(!b)return;const e=F.trim();e&&d(Number(b),{value:e}).then(()=>{j.invalidateQueries({queryKey:l.minusWordsRoot})}).catch(e=>{console.error("Failed to update minus word",e),alert("Не удалось сохранить минус-слово. Попробуйте еще раз.")}).finally(()=>{y([]),W()})},onClose:W})]})};export{j as MinusWordsPage};
